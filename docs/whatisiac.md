---
id: whatisiac
title: Infrastructure as Code とは
sidebar_label: Infrastructure as Code とは
---

import useBaseUrl from "@docusaurus/useBaseUrl";

**Infrastructure as Code** は、ソフトウェア開発のプラクティスをインフラの構築プロセスに活かす方法です。インフラストラクチャはクラウド上にプロビジョニングするスタイルが主力の現代において、もはや広く一般的に普及したでしょう。インフラのプロビジョニングや設定、またその変更作業は、（しばしばテンプレートと呼ばれる）構成定義ファイルによって行われます。この構成定義ファイルは YAML や JSON 形式といったファイルで記述されることが一般的です。

インフラを定義ファイルとして記述し、そのファイルを変更することで実際にプロビジョニングされたインフラを変更する。この方法を採用することで、Git などのバージョン管理システムと組み合わせることで CI / CD パイプラインを構成し、インフラの構成変更作業を自動化できます。

<div style={{ textAlign: "center" }}>
  <img alt="Docusaurus with Keytar" src={useBaseUrl("img/draw.png")} />
</div>

## Infrastructure as Code の原則

Infrastructure as Code の思想は以下の原則に従います。
この原則から逸脱しているものは Infrastructure as Code ではなく、合理的に実装ができていない単なる自動化スクリプトです。
Infrastructure as Code をプロジェクトに導入する上では必ず以下の原則を守れるように考慮しましょう。

:::note Infrastructure as Code の原則

1. **簡単に再現できるシステムであること**<br/>
   ほとんどの作業が自動化されている状態である

2. **使い捨てにできるシステムであること**<br/>
   変化に合わせて今あるものを除却/追加しやすい状態である

3. **統一的なシステムであること**<br/>
   同じ役割をもつサーバがほとんど同じ状態である

4. **反復できるプロセスであること** <br/>
   誰がいつやっても同じ状態をつくれる状態であること

:::

### 1. 簡単に再現できるシステムであること

インフラ構築のために必要な作業は自動化されていることが前提です。
1 つのスクリプト、あるいは 1 つのパイプランプを使用して意味のある単位のインフラリソースをプロビジョニングできる状態にしておくことが理想的です。
「このコマンドを実行してから次にこのパラメータを変更して…」などが記載されているドキュメントは、システムを再現・再構築するための足枷となってしまいます。
ドキュメントではなく、自動化スクリプトを綺麗に保つことに力を注ぎましょう。

### 2. 使い捨てにできるシステムであること

システムは常に成長しつづけます。アプリケーションの刷新、プロキシ構成の追加、DB のバージョンアップなど様々な変更が行われることでしょう。
IaC で構築されていないシステムの場合、複数のリソースが互いに依存関係にあります。「A のサーバを削除してからでないと、B のロードバランサが削除できない」などの複雑さを招いてしまい、削除が困難になります。
IaC を導入する場合は、個々のリソースを削除し、容易に置き換えるようにしておかなければいけません。IaC によって構築されるリソース群（CloudFormation ではスタックと呼ばれる）ごとに置換可能な構成としましょう。

### 3. 統一的なシステムであること

たとえば、１つの ALB(Application Load Balancer)のターゲットグループに２台の EC2 が登録されている構成を考えましょう。
この２つの EC2 は IP アドレスのような個々を区別するような設定を除いて、ソフトウェア構成や設定は同一でなければいけません。
たとえ一時的な設定変更だとしても、SSH でサーバにログインして設定変更をしてしまうと、すぐに全ての変更を管理できなくなることに気がつくでしょう。
全ての変更は IaC を介して行われるべきで、複数のサーバに対して  適用できるようにしておくことが求められます。

### 4. 反復できるプロセスであること

システムを維持しているのはあなた１人ではありません。必ずチームがあります。たとえ今はあなた１人しかいなかったとしても、後世に残すことができるように努めるべきです。
もちろんドキュメントに残すこと必要な方法ですが、スクリプティングの文化を作ることを意識しましょう。
たとえどんなに簡単な設定変更だとしてもスクリプトで実行できるようにしておき、さらに言えばデプロイのパイプラインに反映させておくべきです。
現代のクラウド技術を鑑みれば、全ての設定変更をスクリプト化するのはそう難しくはないはずです。

---

## チェックリスト

あなたのシステムは以下の原則に従っていますか？
もし従っていない場合は、IaC のメリットを最大限に享受できていないでしょう。

<form>
  <input type="checkbox" /> 1. 簡単に再現できるシステムであること
  <br />
  <input type="checkbox" /> 2. 使い捨てにできるシステムであること
  <br />
  <input type="checkbox" /> 3. 統一的なシステムであること
  <br />
  <input type="checkbox" /> 4. 反復できるプロセスであること
  <br />
</form>
